<meta charset="UTF-8">
<pre></pre>
<ol></ol>
<script src="mustache.js"></script>
<script>
  const element = document.querySelector("pre")
  const results = document.querySelector("ol");

  let allPassed = true

  const templates = [
    'var is {{var}}',
    'zero value is {{zerovar}}',
    'undefined var is {{undefinedvar}}',
    `nested object is
  {{#obj}}
    {{#goes}}
    {{deep}}
    {{/goes}}
  {{/obj}}`,
    'dot syntax is {{obj.goes.deep}}',
    'dot syntax in section is {{#obj.goes}}{{deep}}{{/obj.goes}}',
    `list is

  {{#list}}
    {{item}}
  {{/list}}`,
    `inverted is
  {{^inverted}}
    okay
  {{/inverted}}`,
    `dot is
  {{#dot}}
    {{.}}
  {{/dot}}`,
    `lambda is
  {{#lambda}}
    {{{raw}}}
  {{/lambda}}`,
    'raw is {{{raw}}}',
    'raw2 is {{&raw}}',
    'comment is {{!not}} okay',
    'partial is {{>partial}}'
  ]

  const expected = [
    'var is &lt;okay&gt;',
    'zero value is 0',
    'undefined var is ',
    'nested object is\n  \n    \n    okay\n    \n  ',
    'dot syntax is okay',
    'dot syntax in section is okay',
    'list is\n\n  \n    okay\n  \n    okay2\n  ',
    'inverted is\n  \n    okay\n  ',
    'dot is\n  \n    okay\n  ',
    'lambda is\n  <b>\n    <okay>\n  okay</b>',
    'raw is <okay>',
    'raw2 is <okay>',
    'comment is  okay',
    'partial is <okay>'
  ]

  const ctx = {
    var: "<okay>",
    obj: {goes: {deep: "okay"}},
    list: [{item: "okay"}, {item: "okay2"}],
    dot: ["okay"],
    raw: "<okay>",
    inverted: false,
    lambda: function (text, render) {
      return "<b>" + render(text + this.dot[0]) + "</b>"
    },
    partial: "{{{var}}}",
    zerovar: 0
  }

  templates.forEach(function (template, i) {
    const output = mustache(template, ctx)
    const passed = output === expected[i];

    results.insertAdjacentHTML("beforeend", `
        <li value="${i + 1}">
          <span>${passed?'✅ Passed':'❌ Failed'}</span>
        </li>
      `)

    allPassed = allPassed && passed
    console.log(output)
  })

  const template = templates.join("\n")
  const start = Date.now()
  let n = 100
  while (n--) {
    mustache(template, ctx)
  }
  element.insertAdjacentHTML("beforeend", `Rendered in ${(Date.now() - start) / 100}ms\n`)
  element.insertAdjacentHTML("beforeend", `Test ${allPassed ? "successful :)" : `FAILED :(`}`)
</script>
